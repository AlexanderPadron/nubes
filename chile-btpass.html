<html>
    <body>
        <!-- <a href="https://sx-b2c.segurosfalabella.com/VIDA_COLOMBIA/pos/flow/VIDA/7">Vida Colombia</a> -->
        <div class="col-12 col-md-6 text-center product-banner--info-container pb40 pb-md-0 pr20 pl20">
            <a href="https://sx-b2c-dev.segurosfalabella.com/VIDA_CHILE/login" target="_blank">Vida Chile Nubes2</a>
        </div>
        <hr>
	    <div id="dni"></div>
        <hr>
   
    <iframe src="https://sx-b2c-dev.segurosfalabella.com/byPassDev.html" name="sox" id="sox" frameborder="0" width="0" height="0"></iframe>
    </body>
    <script>
	var notSupport =
  navigator.vendor &&
  navigator.vendor.indexOf("Apple") > -1 &&
  navigator.userAgent &&
  navigator.userAgent.indexOf("CriOS") == -1 &&
  navigator.userAgent.indexOf("FxiOS") == -1;
var inject = false;
console.log("MS soportado", notSupport);
if (
  !notSupport &&
  (navigator.userAgent.match(/iPhone/i) ||
    navigator.userAgent.match(/Firefox/i))
) {
  console.log("MS", "detectamos iphone");
  notSupport = true;
}
var miDiv = document.getElementById("dni");
window.addEventListener("message", function (event) {
  if (event.origin === "https://sx-b2c-dev.segurosfalabella.com") {
    if(event.data.message.token){
	window.location.href = link;
    } else {
	console.log("MS", "Recibimos el evento desde el iframe", event.data);
    	notSupport = false;
    	changeUrl('evento iframe');
    }
  }else{
    console.log('Evento bloqueado')
  }
});

changeUrl('Flujo normal')

var link = "https://sx-b2c-dev.segurosfalabella.com/VIDA_CHILE/login";

function changeUrl(context) {
  console.log('Contexto',{context},{notSupport})
  if(!notSupport) {
    link = "https://sx-b2c-dev.segurosfalabella.com/VIDA_CHILE/pos/flow/VIDA/6";    
	// Crea el campo de entrada de texto
	var inputTexto = document.createElement("input");
	inputTexto.type = "text";
	inputTexto.placeholder = "11111111-8";
	inputTexto.id = "textoInput";

	// Crea el botón
	var boton = document.createElement("button");
	boton.textContent = "Enviar al flujo";
	boton.addEventListener("click", ejecutarMetodo);

	// Agrega el campo de entrada de texto y el botón al elemento <div>
	  if(!inject){
		inject = true;
		miDiv.appendChild(inputTexto);
		miDiv.appendChild(boton);  
	  }
  }
//   var theLinks = document.querySelectorAll(".product-banner--info-container a");
//   theLinks.forEach(function (element, index) {
//     element.href = link;
//   });
}
	    
	    // Método a ejecutar cuando se hace clic en el botón
function ejecutarMetodo() {
    var dni = document.getElementById("textoInput").value;
    var win = window.frames.sox;
    win.postMessage({ dni }, '*');
  // Llama al método existente con el texto ingresado u realiza la acción que necesites
}
    </script>
</html>
